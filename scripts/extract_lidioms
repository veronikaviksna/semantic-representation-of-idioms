# -*- coding: utf-8 -*-

Automatically generated by Colab.

The original file is located at
    colab
"""

!pip install rdflib
import requests
import base64
import pandas as pd
from rdflib import Graph, Namespace, Literal, RDF

API_URL = "https://api.github.com/repos/dice-group/LIdioms/contents/rus/russian.ttl"
TTL_PATH = "data/russian.ttl"
CSV_OUT = "data/lidioms_raw.csv"


def main():
    # Download TTL
    response = requests.get(API_URL)
    response.raise_for_status()

    content = base64.b64decode(response.json()["content"]).decode("utf-8")
    with open(TTL_PATH, "w", encoding="utf-8") as f:
        f.write(content)

    # Parse RDF
    g = Graph()
    g.parse(TTL_PATH, format="ttl")

    ONTOLEX = Namespace("http://www.w3.org/ns/lemon/ontolex#")
    SKOS = Namespace("http://www.w3.org/2004/02/skos/core#")

    rows = []

    for entry in g.subjects(RDF.type, ONTOLEX.LexicalEntry):
        idiom_ru = None
        definition_en = None

        for form in g.objects(entry, ONTOLEX.canonicalForm):
            for rep in g.objects(form, ONTOLEX.writtenRep):
                if isinstance(rep, Literal) and rep.language == "rus":
                    idiom_ru = str(rep)

        for sense in g.objects(entry, ONTOLEX.sense):
            for concept in g.objects(sense, ONTOLEX.isLexicalizedSenseOf):
                for definition in g.objects(concept, SKOS.definition):
                    if isinstance(definition, Literal) and definition.language == "en":
                        definition_en = str(definition)

        if idiom_ru and definition_en:
            rows.append({
                "idiom_ru": idiom_ru,
                "definition_en": definition_en,
            })

    df = pd.DataFrame(rows)
    df.to_csv(CSV_OUT, index=False)


if __name__ == "__main__":
    main()
